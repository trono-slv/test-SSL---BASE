<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Sicurezza Lavoro - D.Lgs. 81/2008 | 30 Minuti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nero': '#0f0f0f',
                        'grigio-scuro': '#1f1f1f',
                        'grigio-medio': '#374151',
                        'grigio-chiaro': '#6b7280',
                        'rosso': '#dc2626',
                        'arancione': '#f97316',
                        'arancione-chiaro': '#fbbf24'
                    },
                    animation: {
                        'fadeIn': 'fadeIn 0.5s ease-in-out',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slideUp': 'slideUp 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <link rel="manifest" href="data:application/manifest+json,{'name':'Quiz Sicurezza Lavoro D.Lgs. 81/2008','short_name':'Sicurezza Quiz','start_url':'/','display':'standalone','background_color':'#0f0f0f','theme_color':'#dc2626','icons':[{'src':'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iOTYiIGN5PSI5NiIgcj0iOTYiIGZpbGw9IiNEQzI2MjYiLz48cGF0aCBkPSJNNjAgMTIwTDgwIDEwMEw5NiAxMTZMMTMyIDgwTDE1MiAxMDBMMTIwIDE0MEw2MCAxMjBaIiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==','sizes':'192x192','type':'image/svg+xml'}]}">
    <meta name="theme-color" content="#dc2626">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .glass { backdrop-filter: blur(20px); background: rgba(31, 31, 31, 0.8); border: 1px solid rgba(255,255,255,0.1); }
        .gradient-bg { background: linear-gradient(135deg, #0f0f0f 0%, #1f1f1f 50%, #dc2626 100%); }
        .shadow-glow { box-shadow: 0 25px 50px -12px rgba(220, 38, 38, 0.25); }
        .option-hover { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .option-hover:hover { transform: translateX(8px); box-shadow: 0 10px 25px rgba(247, 115, 22, 0.3); }
        @media (max-width: 640px) { .glass { backdrop-filter: blur(10px); } }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white overflow-x-hidden">
    <!-- Header -->
    <header class="glass sticky top-0 z-50 backdrop-blur-xl border-b-0 shadow-2xl">
        <div class="max-w-4xl mx-auto px-6 py-4">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl flex items-center justify-center shadow-glow animate-pulse-slow">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-white to-gray-200 bg-clip-text text-transparent">Quiz Sicurezza Lavoro</h1>
                        <p class="text-sm text-gray-400 font-medium">D.Lgs. 81/2008 - Testo Unico</p>
                    </div>
                </div>
                <div class="flex items-center gap-6 flex-wrap">
                    <div class="flex items-center gap-2 text-sm font-medium">
                        <div id="timer" class="text-xl font-bold text-orange-400">30:00</div>
                        <div class="w-2 h-2 bg-orange-400 rounded-full animate-pulse"></div>
                    </div>
                    <div class="flex items-center gap-2 text-xs bg-gray-800/50 px-3 py-1 rounded-full glass">
                        <div id="questionCounter" class="font-semibold text-orange-400">1</div>
                        <span>/ 15</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-6 py-12 pb-24">
        <!-- Progress Bar -->
        <div class="w-full bg-gray-800/50 rounded-full h-2 mb-12 overflow-hidden glass">
            <div id="progress" class="h-full bg-gradient-to-r from-orange-400 to-red-500 rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="glass rounded-3xl p-8 md:p-12 shadow-2xl shadow-red-500/10 animate-fadeIn" role="main" aria-label="Contenitore quiz">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="text-center animate-fadeIn">
                <div class="w-24 h-24 mx-auto mb-8 bg-gradient-to-r from-red-500 via-orange-500 to-red-500 rounded-3xl flex items-center justify-center shadow-2xl shadow-red-500/30">
                    <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-white to-gray-200 bg-clip-text text-transparent mb-6">Test di Sicurezza</h2>
                <p class="text-xl text-gray-300 mb-8 max-w-md mx-auto leading-relaxed">15 domande casuali â€¢ 30 minuti â€¢ Avanza con un click/touch</p>
                <button id="startQuizBtn" class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-400 hover:to-red-400 text-white font-bold py-4 px-12 rounded-2xl text-lg shadow-2xl shadow-orange-500/25 hover:shadow-orange-500/40 transform hover:-translate-y-1 transition-all duration-300 inline-block">
                    ðŸš€ Inizia Quiz
                </button>
            </div>

            <!-- Quiz Screen -->
            <div id="quizScreen" class="hidden">
                <div class="text-center mb-12">
                    <h3 id="questionText" class="text-2xl md:text-3xl font-bold text-white mb-8 leading-tight animate-fadeIn"></h3>
                    <div id="optionsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto"></div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="hidden animate-slideUp">
                <div class="text-center mb-12">
                    <div id="resultIcon" class="w-32 h-32 mx-auto mb-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-3xl flex items-center justify-center shadow-2xl shadow-green-500/30">
                        <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h2 id="finalScore" class="text-4xl md:text-5xl font-black bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent mb-4">15/15</h2>
                    <p id="finalMessage" class="text-2xl font-semibold text-gray-300 mb-12">Perfetto! Hai superato il test!</p>
                </div>
                <div id="resultsList" class="space-y-4 max-h-96 overflow-y-auto mb-12"></div>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button id="repeatQuizBtn" class="flex-1 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-400 hover:to-red-400 text-white font-bold py-4 px-8 rounded-2xl shadow-2xl shadow-orange-500/25 hover:shadow-orange-500/40 transform hover:-translate-y-1 transition-all duration-300">
                        ðŸ”„ Ripeti Questo Quiz
                    </button>
                    <button id="newQuizBtn" class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white font-bold py-4 px-8 rounded-2xl shadow-2xl shadow-gray-500/25 hover:shadow-gray-500/40 transform hover:-translate-y-1 transition-all duration-300">
                        ðŸŽ² Nuovo Quiz Casuale
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="glass border-t border-gray-800/50 mt-24">
        <div class="max-w-4xl mx-auto px-6 py-8 text-center text-sm text-gray-500">
            <p>Quiz basato sul <strong>D.Lgs. 81/2008</strong> - Testo Unico sulla Sicurezza sul Lavoro</p>
            <p class="mt-1">Â© 2024 - App per formazione aziendale â€¢ PWA Ready</p>
        </div>
    </footer>

    <script>
        // === PANIERE COMPLETO (66 domande) ===
        const allQuestions = [
            {question: "Qual Ã¨ l'obiettivo principale del D.Lgs. 81/2008?", options: ["Eliminare ogni forma di lavoro manuale", "Tutelare la salute e la sicurezza dei lavoratori nei luoghi di lavoro", "Garantire un aumento di stipendio ai lavoratori a rischio", "Proteggere solo i macchinari aziendali"], correct: 1},
            {question: "Chi Ã¨ il \"Datore di Lavoro\" secondo il D.Lgs. 81/08?", options: ["Il responsabile delle risorse umane", "Il soggetto titolare del rapporto di lavoro con il lavoratore o che ha la responsabilitÃ  dell'organizzazione", "Il socio di maggioranza dell'azienda", "Il direttore dei lavori"], correct: 1},
            {question: "Qual Ã¨ la definizione corretta di \"Pericolo\" (Art. 2 D.Lgs. 81/08)?", options: ["La probabilitÃ  che accada un infortunio", "Una proprietÃ  o qualitÃ  intrinseca di un determinato fattore avente il potenziale di causare danni", "La combinazione tra danno e probabilitÃ ", "Un evento mancato (near miss)"], correct: 1},
            {question: "Qual Ã¨ la definizione corretta di \"Rischio\"?", options: ["La certezza che accada un infortunio", "Un oggetto tagliente lasciato incustodito", "ProbabilitÃ  di raggiungimento del livello potenziale di danno nelle condizioni di impiego o di esposizione", "La spesa sostenuta per la sicurezza"], correct: 2},
            {question: "Cosa indica l'acronimo RSPP?", options: ["Rappresentante Sindacale per la Protezione", "Responsabile del Servizio di Prevenzione e Protezione", "Responsabile Sanitario del Primo Pronto soccorso", "Rappresentante della Sicurezza dei Preposti"], correct: 1},
            {question: "Chi nomina il Medico Competente?", options: ["Il Datore di Lavoro", "L'INAIL", "Il Rappresentante dei Lavoratori per la Sicurezza (RLS)", "La ASL di competenza"], correct: 0},
            {question: "Cosa si intende per \"DPI\"?", options: ["Dispositivi di Prevenzione Incendi", "Dispositivi di Protezione Individuale", "Documento per l'IntegritÃ ", "Disposizioni Per Infortuni"], correct: 1},
            {question: "Secondo l'Art. 20 del D.Lgs. 81/08, il lavoratore ha l'obbligo di:", options: ["Acquistare i propri DPI", "Prendersi cura della propria salute e sicurezza e di quella delle altre persone presenti", "Delegare la sicurezza esclusivamente al Datore di Lavoro", "Modificare i macchinari per renderli piÃ¹ veloci"], correct: 1},
            {question: "Il lavoratore puÃ² rimuovere o modificare senza autorizzazione i dispositivi di sicurezza?", options: ["SÃ¬, se rallentano il lavoro", "SÃ¬, se Ã¨ esperto", "No, mai (Art. 20 D.Lgs. 81/08)", "Solo durante il turno di notte"], correct: 2},
            {question: "Chi Ã¨ l'RLS?", options: ["Il Responsabile dei Lavori Sicuri", "Il Rappresentante dei Lavoratori per la Sicurezza", "Il Responsabile Legale della SocietÃ ", "Il Rappresentante del Lavoro Sindacale"], correct: 1},
            {question: "Quando Ã¨ obbligatoria la formazione sulla sicurezza per i lavoratori?", options: ["Solo in caso di infortunio", "All'assunzione, al trasferimento o cambiamento di mansioni, e all'introduzione di nuove attrezzature/tecnologie", "Solo se il lavoratore lo richiede", "Ogni 10 anni"], correct: 1},
            {question: "Qual Ã¨ il colore della segnaletica di sicurezza che indica \"Divieto\"?", options: ["Giallo", "Verde", "Rosso", "Azzurro"], correct: 2},
            {question: "Qual Ã¨ il colore della segnaletica che indica \"Obbligo\" (es. indossare caschetto)?", options: ["Rosso", "Azzurro", "Giallo", "Verde"], correct: 1},
            {question: "Qual Ã¨ il colore della segnaletica che indica \"Salvataggio/Soccorso\" (es. uscite di emergenza)?", options: ["Verde", "Rosso", "Arancione", "Bianco"], correct: 0},
            {question: "Cosa significa \"Prevenzione\"?", options: ["Curare il lavoratore dopo l'infortunio", "L'insieme delle misure previste per evitare o diminuire i rischi professionali", "Pagare l'assicurazione INAIL", "Indossare solo il casco"], correct: 1},
            {question: "Cosa deve fare un lavoratore se nota una condizione di pericolo immediato (es. cavo scoperto)?", options: ["Ignorarla e continuare a lavorare", "Segnalarla immediatamente al Datore di Lavoro, Dirigente o Preposto", "Tentare di ripararla da solo anche se non competente", "Scrivere una mail al sindacato"], correct: 1},
            {question: "La Sorveglianza Sanitaria (visite mediche) Ã¨:", options: ["Facoltativa per tutti", "Obbligatoria nei casi previsti dalla normativa vigente", "A pagamento a carico del lavoratore", "Obbligatoria solo per chi ha piÃ¹ di 50 anni"], correct: 1},
            {question: "Cos'Ã¨ il \"near miss\" (quasi infortunio)?", options: ["Un infortunio mortale", "Un evento che avrebbe potuto causare un infortunio ma non lo ha fatto", "Un giorno di ferie", "Una sanzione disciplinare"], correct: 1},
            {question: "Qual Ã¨ il numero unico per le emergenze in Italia?", options: ["911", "112", "113", "999"], correct: 1},
            {question: "I guanti di protezione sono:", options: ["Un dispositivo di protezione collettiva", "Un dispositivo di protezione individuale (DPI)", "Un accessorio di moda", "Facoltativi sempre"], correct: 1},
            {question: "Cosa indica un cartello di forma triangolare con bordo nero e fondo giallo?", options: ["Obbligo", "Avvertimento / Pericolo", "Divieto", "Salvataggio"], correct: 1},
            {question: "Qual Ã¨ la principale misura di protezione contro il rischio di incendio?", options: ["Correre velocemente", "Usare gli ascensori", "Seguire le procedure di emergenza ed evacuazione", "Nascondersi sotto la scrivania"], correct: 2},
            {question: "Il lavoratore deve sottoporsi ai controlli sanitari previsti dal Medico Competente?", options: ["No, puÃ² rifiutarsi sempre", "SÃ¬, Ã¨ un obbligo (Art. 20 D.Lgs. 81/08)", "Solo se ha sintomi", "Solo se autorizzato dall'RLS"], correct: 1},
            {question: "Chi paga i DPI necessari per il lavoro?", options: ["Il lavoratore con trattenuta in busta paga", "Il Datore di Lavoro", "L'INAIL al 50%", "Lo Stato"], correct: 1},
            {question: "L'uso di alcol sul luogo di lavoro:", options: ["Ãˆ consentito in pausa pranzo", "Ãˆ vietato, specialmente per mansioni a rischio", "Ãˆ consigliato per riscaldarsi", "Non Ã¨ regolamentato"], correct: 1},
            {question: "In caso di evacuazione, cosa NON bisogna fare?", options: ["Mantenere la calma", "Seguire le vie di fuga", "Utilizzare gli ascensori", "Raggiungere il punto di raccolta"], correct: 2},
            {question: "La segnaletica di sicurezza deve essere:", options: ["Nascosta per non rovinare l'estetica", "Visibile, chiara e conforme alla normativa", "Scritta solo in inglese", "Installata solo all'ingresso"], correct: 1},
            {question: "Qual Ã¨ il compito principale del \"Preposto\"?", options: ["Pagare gli stipendi", "Sovrintendere all'attivitÃ  lavorativa e garantire l'attuazione delle direttive ricevute", "Fare le visite mediche", "Redigere il bilancio aziendale"], correct: 1},
            {question: "Cosa si intende per \"Protezione Collettiva\"?", options: ["I guanti e le scarpe", "Sistemi che proteggono piÃ¹ lavoratori contemporaneamente (es. parapetti, aspiratori)", "L'assicurazione aziendale", "La riunione periodica"], correct: 1},
            {question: "Il lavoratore in formazione Ã¨ considerato:", options: ["Ospite", "Lavoratore a tutti gli effetti ai fini della sicurezza", "Stagista non tutelato", "Visitatore"], correct: 1},
            {question: "Il Rischio Elettrico puÃ² causare:", options: ["Solo un leggero fastidio", "Elettrocuzione (scossa) e ustioni", "Danni all'udito", "Mal di schiena"], correct: 1},
            {question: "La formazione generale dei lavoratori (Accordo Stato-Regioni) dura minimo:", options: ["2 ore", "4 ore", "8 ore", "16 ore"], correct: 1},
            {question: "A chi deve essere inviato il lavoratore che ha subito un infortunio (dopo il primo soccorso)?", options: ["A casa a riposare", "Al Pronto Soccorso o struttura sanitaria competente per il certificato medico", "In ferie", "Dal Datore di Lavoro"], correct: 1},
            {question: "Qual Ã¨ la differenza principale tra \"Infortunio\" e \"Malattia Professionale\"?", options: ["L'infortunio avviene di notte, la malattia di giorno", "L'infortunio ha una causa violenta e immediata; la malattia professionale agisce lentamente nel tempo", "Non c'Ã¨ differenza, sono sinonimi", "L'infortunio riguarda solo gli operai, la malattia solo gli impiegati"], correct: 1},
            {question: "Il Documento di Valutazione dei Rischi (DVR):", options: ["Ãˆ un documento statico che si fa una volta sola all'apertura dell'azienda", "Deve essere custodito presso l'unitÃ  produttiva e aggiornato in caso di modifiche significative al processo lavorativo o organizzativo", "Deve essere inviato ogni anno all'INAIL per approvazione", "Ãˆ redatto esclusivamente dal Medico Competente"], correct: 1},
            {question: "Cos'Ã¨ il DUVRI?", options: ["Documento Unico di Valutazione dei Rischi da Interferenze", "Documento Ufficiale di Verifica Rischi Incendi", "Una certificazione ISO", "Il documento per la valutazione dello stress lavoro-correlato"], correct: 0},
            {question: "Quando si considera un lavoratore \"videoterminalista\" (soggetto a sorveglianza specifica)?", options: ["Se usa il computer almeno 1 ora al giorno", "Se utilizza un'attrezzatura munita di videoterminale in modo sistematico o abituale, per venti ore settimanali", "Se possiede uno smartphone aziendale", "Se lavora in smart working una volta al mese"], correct: 1},
            {question: "Nella movimentazione manuale dei carichi, qual Ã¨ la tecnica corretta per sollevare un peso da terra?", options: ["Tenere le gambe tese e piegare la schiena", "Piegare le ginocchia mantenendo la schiena il piÃ¹ possibile dritta e il carico vicino al corpo", "Sollevare il peso con uno slancio improvviso", "Ruotare il busto mentre si solleva il peso"], correct: 1},
            {question: "Qual Ã¨ la gerarchia corretta delle misure di prevenzione?", options: ["Prima i DPI, poi le misure organizzative, infine l'eliminazione del rischio", "Eliminazione del rischio, sostituzione, misure tecniche/organizzative, mezzi di protezione collettiva, DPI", "Solo formazione e informazione", "Affidarsi completamente ai DPI"], correct: 1},
            {question: "Cosa significa l'acronimo \"MMC\"?", options: ["Movimentazione Manuale dei Carichi", "Misure Minime di Coordinamento", "Medico Medicina Competente", "Movimento Meccanico Controllato"], correct: 0},
            {question: "Il rischio da \"Stress Lavoro-Correlato\":", options: ["Non Ã¨ un rischio riconosciuto dalla legge", "Ãˆ oggetto di valutazione obbligatoria all'interno del DVR", "Riguarda solo i dirigenti", "Si risolve dando piÃ¹ ferie"], correct: 1},
            {question: "Qual Ã¨ la soglia di esposizione al rumore (LEX,8h) oltre la quale scatta l'obbligo per il datore di lavoro di esigere l'uso dei otoprotettori (DPI uditivi)?", options: ["60 dB(A)", "80 dB(A)", "85 dB(A)", "100 dB(A)"], correct: 2},
            {question: "L'aggiornamento della formazione lavoratori (Accordo Stato-Regioni) ha una durata di:", options: ["6 ore ogni 5 anni", "4 ore ogni anno", "8 ore ogni 3 anni", "Non Ã¨ previsto aggiornamento"], correct: 0},
            {question: "Cosa si intende per \"contatto elettrico diretto\"?", options: ["Toccare una parte attiva dell'impianto normalmente in tensione (es. un filo scoperto)", "Toccare la carcassa di un elettrodomestico che ha un guasto interno", "Essere colpiti da un fulmine", "Usare il computer"], correct: 0},
            {question: "Cosa si intende per \"contatto elettrico indiretto\"?", options: ["Toccare un filo scoperto", "Il contatto con una massa (es. carcassa lavatrice) che Ã¨ andata in tensione a causa di un guasto all'isolamento", "Lavorare vicino a una linea alta tensione senza toccarla", "Prendere la scossa cambiando una lampadina"], correct: 1},
            {question: "Qual Ã¨ la funzione dell'interruttore differenziale (\"salvavita\")?", options: ["Proteggere l'impianto dal sovraccarico", "Proteggere le persone dai contatti indiretti interrompendo il flusso di corrente in caso di dispersione", "Risparmiare energia elettrica", "Aumentare la potenza disponibile"], correct: 1},
            {question: "Il lavoratore puÃ² essere sanzionato penalmente?", options: ["No, solo il Datore di Lavoro Ã¨ responsabile", "SÃ¬, se viola gli obblighi dell'Art. 20 (es. rifiuto uso DPI, rimozione protezioni)", "Solo se l'azienda fallisce", "Solo se provoca un danno superiore a 100.000 euro"], correct: 1},
            {question: "Cos'Ã¨ l'\"Infortunio in itinere\"?", options: ["Un infortunio avvenuto durante la pausa caffÃ¨ al bar", "Un infortunio occorso al lavoratore durante il normale percorso di andata e ritorno dal luogo di abitazione a quello di lavoro", "Un infortunio simulato", "Un infortunio avvenuto in un cantiere mobile"], correct: 1},
            {question: "Chi firma il DVR?", options: ["Solo il Datore di Lavoro", "Datore di Lavoro, RSPP, Medico Competente (se nominato) e RLS (per presa visione)", "Tutti i lavoratori dell'azienda", "L'ispettorato del lavoro"], correct: 1},
            {question: "I pittogrammi di pericolo sui prodotti chimici sono attualmente (Regolamento CLP):", options: ["Quadrati a fondo arancione", "Rombi a fondo bianco con cornice rossa", "Cerchi blu", "Triangoli gialli"], correct: 1},
            {question: "Il Medico Competente puÃ² esprimere un giudizio di \"IdoneitÃ  con prescrizioni\"?", options: ["No, solo idoneo o non idoneo", "SÃ¬, indicando limiti o condizioni per lo svolgimento della mansione (es. \"non sollevare pesi > 10kg\")", "SÃ¬, ma solo per le lavoratrici madri", "No, decide l'INAIL"], correct: 1},
            {question: "Le lavoratrici in stato di gravidanza:", options: ["Possono svolgere qualsiasi lavoro senza limiti", "Devono essere allontanate da lavori a rischio (chimico, biologico, fisico, carichi) previa valutazione", "Devono licenziarsi obbligatoriamente", "Devono lavorare solo di notte"], correct: 1},
            {question: "Qual Ã¨ lo scopo della \"Riunione Periodica\" (Art. 35 D.Lgs. 81/08)?", options: ["Festeggiare i risultati aziendali", "Discutere del Documento di Valutazione dei Rischi, dell'andamento infortunistico, dei DPI e della formazione", "Decidere gli aumenti di stipendio", "Ãˆ una riunione facoltativa tra colleghi"], correct: 1},
            {question: "Cosa deve fare un lavoratore che assume farmaci che riducono l'attenzione (es. psicofarmaci, antistaminici forti)?", options: ["Nulla, Ã¨ un fatto privato", "Segnalarlo al Medico Competente se svolge mansioni a rischio (es. guida muletto, macchinari pericolosi)", "Smettere di lavorare per sempre", "Raddoppiare la dose di caffÃ¨"], correct: 1},
            {question: "In caso di incendio, l'uso dell'acqua Ã¨ vietato su:", options: ["Carta e cartone", "Legno", "Apparecchiature elettriche sotto tensione e oli/grassi bollenti", "Tessuti"], correct: 2},
            {question: "La formazione specifica per i lavoratori (Rischio Basso, Medio, Alto) ha durata variabile di:", options: ["4, 8, 12 ore", "4, 8, 16 ore", "Sempre 4 ore", "8, 12, 16 ore"], correct: 0},
            {question: "I DPI di \"Terza Categoria\" (salvavita, es. imbracature anticaduta):", options: ["Richiedono solo la consegna", "Richiedono addestramento specifico obbligatorio per il corretto utilizzo", "Possono essere usati da chiunque senza istruzioni", "Non esistono"], correct: 1},
            {question: "Il Rappresentante dei Lavoratori per la Sicurezza (RLS) ha diritto a:", options: ["Dirigere l'azienda", "Accedere ai luoghi di lavoro in cui si svolgono le lavorazioni", "Firmare gli assegni aziendali", "Sanzionare i colleghi"], correct: 1},
            {question: "Quale di questi Ã¨ un fattore di \"microclima\"?", options: ["La polvere sul pavimento", "Temperatura, umiditÃ , ventilazione", "Il rumore del traffico", "La luminositÃ  dello schermo"], correct: 1},
            {question: "Un lavoratore notturno deve essere sottoposto a controlli medici specifici?", options: ["No, mai", "SÃ¬, periodici a cura del Medico Competente", "Solo se lo richiede", "Solo se ha piÃ¹ di 60 anni"], correct: 1},
            {question: "La delega di funzioni da parte del Datore di Lavoro:", options: ["Lo esonera sempre da ogni responsabilitÃ ", "Deve essere scritta, accettata, e il delegato deve avere autonomia di spesa e competenza; non esonera dall'obbligo di vigilanza", "PuÃ² essere fatta a voce", "Ãˆ vietata dalla legge"], correct: 1},
            {question: "I rischi \"interferenti\" sono gestiti tramite:", options: ["Il DVR aziendale", "Il DUVRI (o PSC nei cantieri)", "Il contratto di assunzione", "La fattura commerciale"], correct: 1},
            {question: "Il divieto di fumo nei luoghi di lavoro:", options: ["Ãˆ una scelta del datore di lavoro", "Ãˆ legge per tutelare i lavoratori dal fumo passivo e prevenire incendi", "Vale solo negli uffici aperti al pubblico", "Non si applica nei bagni"], correct: 1}
        ];

        // === VARIABILI GLOBALI ===
        let selectedQuestions = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let timeRemaining = 1800; // 30 minuti in secondi
        let timerInterval;

        // === FUNZIONI CORE ===
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function selectRandomQuestions() {
            const shuffled = shuffleArray(allQuestions);
            return shuffled.slice(0, 15).map(q => ({
                ...q,
                shuffledOptions: shuffleArray(q.options.map((opt, idx) => ({text: opt, originalIndex: idx})))
            }));
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    endQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeRemaining < 300) {
                document.getElementById('timer').classList.add('text-red-500', 'animate-pulse');
            }
        }

        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / 15) * 100;
            document.getElementById('progress').style.width = `${progress}%`;
        }

        function displayQuestion() {
            const q = selectedQuestions[currentQuestion];
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('questionCounter').textContent = currentQuestion + 1;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            q.shuffledOptions.forEach((option, idx) => {
                const button = document.createElement('button');
                button.className = 'glass option-hover p-6 rounded-2xl text-left text-lg font-medium transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-orange-500/50 hover:bg-gray-700/50';
                button.setAttribute('role', 'button');
                button.setAttribute('aria-label', `Opzione ${idx + 1}: ${option.text}`);
                
                button.innerHTML = `<span class="text-orange-400 font-bold mr-3">${String.fromCharCode(65 + idx)}</span> ${option.text}`;
                
                if (userAnswers[currentQuestion] === null) {
                    button.onclick = () => selectAnswer(option.originalIndex);
                }
                
                optionsContainer.appendChild(button);
            });
            
            updateProgressBar();
        }

        function selectAnswer(answerIndex) {
            userAnswers[currentQuestion] = answerIndex;
            
            setTimeout(() => {
                nextQuestion();
            }, 500);
        }

        function nextQuestion() {
            if (currentQuestion < 14) {
                currentQuestion++;
                displayQuestion();
            } else {
                endQuiz();
            }
        }

        function endQuiz() {
            clearInterval(timerInterval); // âœ… FIX: Ferma timer
            
            const correctAnswers = userAnswers.filter((answer, idx) => 
                answer === selectedQuestions[idx].correct
            ).length;
            
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const scoreElement = document.getElementById('finalScore');
            const messageElement = document.getElementById('finalMessage');
            const iconElement = document.getElementById('resultIcon');
            
            scoreElement.textContent = `${correctAnswers}/15`;
            
            if (correctAnswers >= 14) {
                messageElement.textContent = 'ðŸŽ‰ Eccellente! Sicurezza al top!';
                scoreElement.className = 'text-4xl md:text-5xl font-black bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent mb-4';
                iconElement.className = 'w-32 h-32 mx-auto mb-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-3xl flex items-center justify-center shadow-2xl shadow-green-500/30';
            } else if (correctAnswers >= 12) {
                messageElement.textContent = 'âœ… Ottimo lavoro! Quasi perfetto!';
                scoreElement.className = 'text-4xl md:text-5xl font-black bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent mb-4';
                iconElement.className = 'w-32 h-32 mx-auto mb-8 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-3xl flex items-center justify-center shadow-2xl shadow-blue-500/30';
            } else if (correctAnswers >= 10) {
                messageElement.textContent = 'âš ï¸ Buono, ma rivedi alcuni concetti';
                scoreElement.className = 'text-4xl md:text-5xl font-black bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent mb-4';
                iconElement.className = 'w-32 h-32 mx-auto mb-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-3xl flex items-center justify-center shadow-2xl shadow-yellow-500/30';
            } else {
                messageElement.textContent = 'âŒ Attenzione! Necessaria piÃ¹ formazione';
                scoreElement.className = 'text-4xl md:text-5xl font-black bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent mb-4';
                iconElement.className = 'w-32 h-32 mx-auto mb-8 bg-gradient-to-r from-red-500 to-red-700 rounded-3xl flex items-center justify-center shadow-2xl shadow-red-500/30';
            }
            
            displayResults();
        }

        function displayResults() {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            selectedQuestions.forEach((q, idx) => {
                const userAnswer = userAnswers[idx];
                const isCorrect = userAnswer === q.correct;
                
                const resultCard = document.createElement('div');
                resultCard.className = `glass p-6 rounded-2xl ${isCorrect ? 'border-l-4 border-green-500' : 'border-l-4 border-red-500'}`;
                
                resultCard.innerHTML = `
                    <div class="flex items-start gap-3 mb-3">
                        <div class="w-8 h-8 rounded-lg ${isCorrect ? 'bg-green-500' : 'bg-red-500'} flex items-center justify-center flex-shrink-0">
                            ${isCorrect ? 
                                '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>' :
                                '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>'
                            }
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold text-white mb-2">${idx + 1}. ${q.question}</p>
                            <div class="space-y-2 text-sm">
                                <p class="${isCorrect ? 'text-green-400' : 'text-red-400'} font-medium">
                                    La tua risposta: ${userAnswer !== null ? q.options[userAnswer] : 'Non risposto'}
                                </p>
                                ${!isCorrect ? `<p class="text-green-400 font-medium">Risposta corretta: ${q.options[q.correct]}</p>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                resultsList.appendChild(resultCard);
            });
        }

        function resetQuiz() {
            currentQuestion = 0;
            userAnswers = Array(15).fill(null);
            timeRemaining = 1800; // âœ… FIX: Reset timer completo
            clearInterval(timerInterval);
            document.getElementById('timer').classList.remove('text-red-500', 'animate-pulse');
            document.getElementById('timer').textContent = '30:00'; // âœ… FIX: Reset display
        }

        // === EVENT LISTENERS ===
        document.getElementById('startQuizBtn').addEventListener('click', () => {
            selectedQuestions = selectRandomQuestions();
            resetQuiz();
            
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            displayQuestion();
            startTimer();
        });

        document.getElementById('repeatQuizBtn').addEventListener('click', () => {
            resetQuiz();
            
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            displayQuestion();
            startTimer();
        });

        document.getElementById('newQuizBtn').addEventListener('click', () => {
            resetQuiz();
            selectedQuestions = selectRandomQuestions(); // âœ… Nuove domande casuali
            
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            displayQuestion();
            startTimer();
        });

        // === TOUCH/SWIPE SUPPORT ===
        let touchStartX = 0;
        document.getElementById('quizContainer').addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });
        
        document.getElementById('quizContainer').addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].clientX;
            const swipeThreshold = 50;
            
            if (touchStartX - touchEndX > swipeThreshold && userAnswers[currentQuestion] !== null && currentQuestion < 14) {
                nextQuestion();
            }
        });

        // === PWA SERVICE WORKER ===
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,self.addEventListener("install", e => self.skipWaiting()); self.addEventListener("activate", e => self.clients.claim());')
                .catch(() => {});
        }
    </script>
</body>
</html>
